# Obsidian MCP Server

**URL**: `https://config.superbots.link/mcp/obsidian/*`  
**Version**: `1.0.0`

**Reference**: [mcp-obsidian GitHub](https://github.com/MarkusPfundstein/mcp-obsidian)

---

## Overview

The Obsidian MCP (Model Context Protocol) server provides a standardized interface for AI agents to interact with your Obsidian vault via the Obsidian REST API community plugin. It implements the MCP protocol specification, enabling seamless integration with AI tools like Claude Desktop, Cursor, and VS Code.

**Note**: This server requires the Obsidian REST API plugin to be installed and running locally. The MCP server proxies requests to your local Obsidian instance.

---

## Prerequisites

### 1. Install Obsidian REST API Plugin

Install the [Obsidian Local REST API](https://github.com/coddingtonbear/obsidian-local-rest-api) community plugin:

1. Open Obsidian
2. Go to Settings → Community plugins
3. Search for "Local REST API"
4. Install and enable the plugin
5. Copy your API key from the plugin settings

### 2. Configure Obsidian REST API

**Default Settings**:
- **Host**: `127.0.0.1` (localhost)
- **Port**: `27124`
- **API Key**: Generated by the plugin (copy this!)

**For Remote Access** (optional):
- Change host to `0.0.0.0` to allow remote connections
- Ensure firewall allows connections on port 27124
- **Security Warning**: Only enable remote access on trusted networks

---

## Features

- ✅ **MCP Protocol Compliance**: Full implementation of MCP protocol endpoints
- ✅ **Obsidian Integration**: Direct access to Obsidian vault via REST API
- ✅ **Credential Management**: Store Obsidian config via Pow3r Pass
- ✅ **Tool Discovery**: List available tools, resources, and prompts
- ✅ **SSE Streaming**: Server-Sent Events support for real-time updates
- ✅ **CORS Support**: Full CORS headers for cross-origin access
- ✅ **Vault Operations**: Read, write, search, and manage vault files

---

## API Endpoints

### Initialize MCP Connection

```http
POST /mcp/obsidian/initialize
```

Initialize the MCP server connection and get server capabilities.

**Response**:
```json
{
  "success": true,
  "data": {
    "name": "obsidian-mcp-server",
    "version": "1.0.0",
    "protocolVersion": "2024-11-05",
    "capabilities": {
      "tools": { "listChanged": true },
      "resources": { "subscribe": true, "listChanged": true },
      "prompts": { "listChanged": true }
    }
  }
}
```

---

### List Available Tools

```http
GET /mcp/obsidian/tools/list
```

Get a list of all available MCP tools (Obsidian operations).

**Available Tools**:
1. **`obsidian_list_files_in_vault`** - List all files in vault root
2. **`obsidian_list_files_in_dir`** - List files in a specific directory
3. **`obsidian_get_file_contents`** - Get contents of a file
4. **`obsidian_search`** - Search vault for text
5. **`obsidian_patch_content`** - Insert content into a note
6. **`obsidian_append_content`** - Append content to a file
7. **`obsidian_delete_file`** - Delete a file or directory

---

### Call a Tool

```http
POST /mcp/obsidian/tools/call
Content-Type: application/json

{
  "name": "obsidian_get_file_contents",
  "arguments": {
    "file_path": "Notes/Meeting.md",
    "obsidian_api_key": "your-api-key",
    "obsidian_host": "127.0.0.1",
    "obsidian_port": "27124"
  }
}
```

**Example: List Files in Vault**:
```bash
curl -X POST "https://config.superbots.link/mcp/obsidian/tools/call" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "obsidian_list_files_in_vault",
    "arguments": {
      "obsidian_api_key": "your-api-key",
      "obsidian_host": "127.0.0.1",
      "obsidian_port": "27124"
    }
  }'
```

**Example: Get File Contents**:
```bash
curl -X POST "https://config.superbots.link/mcp/obsidian/tools/call" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "obsidian_get_file_contents",
    "arguments": {
      "file_path": "Notes/Meeting.md",
      "obsidian_api_key": "your-api-key"
    }
  }'
```

**Example: Search Vault**:
```bash
curl -X POST "https://config.superbots.link/mcp/obsidian/tools/call" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "obsidian_search",
    "arguments": {
      "query": "project planning",
      "obsidian_api_key": "your-api-key"
    }
  }'
```

**Example: Append to Note**:
```bash
curl -X POST "https://config.superbots.link/mcp/obsidian/tools/call" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "obsidian_append_content",
    "arguments": {
      "file_path": "Notes/Daily.md",
      "content": "\n## New Entry\nToday I learned...",
      "obsidian_api_key": "your-api-key"
    }
  }'
```

---

## Configuration

### Option 1: Store in Pow3r Pass (Recommended)

Store Obsidian configuration in Pow3r Pass for automatic retrieval:

```bash
curl -X POST "https://config.superbots.link/pass/credentials/obsidian" \
  -H "Content-Type: application/json" \
  -d '{
    "value": {
      "apiKey": "your-obsidian-api-key",
      "host": "127.0.0.1",
      "port": "27124"
    }
  }'
```

**Note**: Store as JSON object with `apiKey`, `host`, and `port` fields.

### Option 2: Provide in Request

You can also provide configuration in each request:

```json
{
  "name": "obsidian_list_files_in_vault",
  "arguments": {
    "obsidian_api_key": "your-api-key",
    "obsidian_host": "127.0.0.1",
    "obsidian_port": "27124"
  }
}
```

### Default Values

- **Host**: `127.0.0.1` (if not provided)
- **Port**: `27124` (if not provided)
- **API Key**: Required (no default)

---

## Integration with AI Tools

### Cursor

Already configured in `.cursor/mcp.json`:

```json
{
  "mcpServers": {
    "obsidian": {
      "url": "https://config.superbots.link/mcp/obsidian/sse",
      "transport": "sse",
      "description": "Obsidian MCP Server - Interact with Obsidian vault via REST API"
    }
  }
}
```

### Claude Desktop

Add to `claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "obsidian": {
      "url": "https://config.superbots.link/mcp/obsidian/sse",
      "transport": "sse"
    }
  }
}
```

### VS Code with GitHub Copilot

Add to `.vscode/mcp.json`:

```json
{
  "mcpServers": {
    "obsidian": {
      "url": "https://config.superbots.link/mcp/obsidian/sse",
      "transport": "sse"
    }
  }
}
```

---

## Usage Examples

### Example 1: Search and Summarize

```
Use obsidian_search to find all notes mentioning "project planning", then use obsidian_get_file_contents to read the most recent one and summarize it.
```

### Example 2: Create Meeting Summary

```
Get the contents of the last architecture call note, summarize it, and append the summary to a new note called "Meeting Summaries.md".
```

### Example 3: Organize Notes

```
Search for all files where "Azure CosmosDb" is mentioned and list them with their file paths.
```

### Example 4: Update Note

```
Read the file "Projects/Current.md" and append a new section with today's progress.
```

---

## Tool Reference

### obsidian_list_files_in_vault

List all files and directories in vault root.

**Arguments**: None

**Response**:
```json
{
  "files": ["Note1.md", "Note2.md"],
  "directories": ["Projects", "Notes"]
}
```

---

### obsidian_list_files_in_dir

List files in a specific directory.

**Arguments**:
- `directory` (required): Directory path relative to vault root

**Example**:
```json
{
  "name": "obsidian_list_files_in_dir",
  "arguments": {
    "directory": "Projects/2024"
  }
}
```

---

### obsidian_get_file_contents

Get the contents of a file.

**Arguments**:
- `file_path` (required): Path to file relative to vault root

**Example**:
```json
{
  "name": "obsidian_get_file_contents",
  "arguments": {
    "file_path": "Notes/Meeting.md"
  }
}
```

---

### obsidian_search

Search vault for text.

**Arguments**:
- `query` (required): Text query to search for

**Example**:
```json
{
  "name": "obsidian_search",
  "arguments": {
    "query": "project planning"
  }
}
```

---

### obsidian_patch_content

Insert content into a note relative to a heading or block.

**Arguments**:
- `file_path` (required): Path to file
- `content` (required): Content to insert
- `position` (optional): "before", "after", or "replace" (default: "after")
- `target` (optional): Heading name, block reference, or frontmatter field

**Example**:
```json
{
  "name": "obsidian_patch_content",
  "arguments": {
    "file_path": "Notes/Meeting.md",
    "content": "New content here",
    "position": "after",
    "target": "## Action Items"
  }
}
```

---

### obsidian_append_content

Append content to a file (creates file if it doesn't exist).

**Arguments**:
- `file_path` (required): Path to file
- `content` (required): Content to append

**Example**:
```json
{
  "name": "obsidian_append_content",
  "arguments": {
    "file_path": "Notes/Daily.md",
    "content": "\n## 2024-11-08\nToday's notes..."
  }
}
```

---

### obsidian_delete_file

Delete a file or directory.

**Arguments**:
- `file_path` (required): Path to file or directory

**Example**:
```json
{
  "name": "obsidian_delete_file",
  "arguments": {
    "file_path": "Notes/OldNote.md"
  }
}
```

---

## Error Handling

All errors include `aiGuidance` for AI agents:

```json
{
  "success": false,
  "error": {
    "message": "Configuration Required",
    "code": "OBSIDIAN_CONFIG_REQUIRED",
    "aiGuidance": {
      "issue": "Obsidian REST API configuration missing",
      "solution": "Provide Obsidian API configuration",
      "steps": [
        "1. Store Obsidian config: POST /pass/credentials/obsidian",
        "2. Or provide in request: obsidian_api_key, obsidian_host, obsidian_port",
        "3. Install Obsidian REST API plugin"
      ]
    }
  }
}
```

**Connection Errors**:
```json
{
  "success": false,
  "error": {
    "code": "OBSIDIAN_CONNECTION_ERROR",
    "aiGuidance": {
      "issue": "Cannot connect to Obsidian REST API",
      "solution": "Verify Obsidian REST API plugin is running and accessible",
      "troubleshooting": [
        "Check Obsidian REST API plugin is installed and enabled",
        "Verify API key is correct",
        "Ensure Obsidian is running",
        "Check host and port are correct (default: 127.0.0.1:27124)"
      ]
    }
  }
}
```

---

## Architecture

```
┌─────────────────────────────────────────┐
│         AI Agent (Claude/Cursor)        │
└──────────────┬──────────────────────────┘
               │ MCP Protocol
               │ (SSE/HTTP)
               ▼
┌─────────────────────────────────────────┐
│   Obsidian MCP Server (Cloudflare)      │
│   config.superbots.link/mcp/obsidian    │
└──────────────┬──────────────────────────┘
               │
               ├──► Pow3r Pass (Config)
               │
               └──► Obsidian REST API
                    http://127.0.0.1:27124
                    (Local)
```

---

## Security Considerations

### Local Access Only (Recommended)

By default, Obsidian REST API runs on `127.0.0.1`, which only allows local connections. This is the most secure option.

### Remote Access

If you need remote access:

1. **Change Obsidian REST API host** to `0.0.0.0` in plugin settings
2. **Use a VPN or SSH tunnel** for secure remote access
3. **Never expose Obsidian REST API** directly to the internet without authentication

### API Key Security

- **Never commit API keys** to version control
- **Store keys securely** in Pow3r Pass
- **Rotate keys regularly** if compromised

---

## Troubleshooting

### Cannot Connect to Obsidian

1. **Check Obsidian is Running**: Ensure Obsidian application is open
2. **Verify Plugin is Enabled**: Check Obsidian REST API plugin is installed and enabled
3. **Check API Key**: Verify the API key matches the one in plugin settings
4. **Test Direct Connection**:
   ```bash
   curl http://127.0.0.1:27124/vault/ \
     -H "Authorization: Bearer your-api-key"
   ```

### Files Not Found

- **Check File Paths**: Use paths relative to vault root (e.g., `Notes/File.md` not `/Notes/File.md`)
- **Verify File Exists**: Check the file exists in Obsidian
- **Check Permissions**: Ensure Obsidian REST API has permission to access the file

### Search Not Working

- **Check Query Format**: Search uses Obsidian's search syntax
- **Verify Index**: Obsidian may need to index files first
- **Try Simple Queries**: Start with simple text queries

---

## Testing

Test the MCP server:

```bash
# Initialize
curl -X POST "https://config.superbots.link/mcp/obsidian/initialize"

# List tools
curl -X GET "https://config.superbots.link/mcp/obsidian/tools/list"

# Test connection (requires Obsidian running)
curl -X POST "https://config.superbots.link/mcp/obsidian/tools/call" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "obsidian_list_files_in_vault",
    "arguments": {
      "obsidian_api_key": "your-api-key",
      "obsidian_host": "127.0.0.1",
      "obsidian_port": "27124"
    }
  }'
```

---

## References

- [mcp-obsidian GitHub](https://github.com/MarkusPfundstein/mcp-obsidian)
- [Obsidian Local REST API](https://github.com/coddingtonbear/obsidian-local-rest-api)
- [Model Context Protocol Specification](https://modelcontextprotocol.io)
- [Cloudflare MCP Server Guide](https://developers.cloudflare.com/agents/guides/remote-mcp-server/)

---

## Status

✅ **Deployed**: Production  
✅ **Tested**: Basic endpoints verified  
✅ **Documentation**: Complete  
✅ **Integration**: Ready for AI tools

**Note**: Requires Obsidian REST API plugin to be running locally for full functionality.

